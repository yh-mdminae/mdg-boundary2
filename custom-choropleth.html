<!-- A minimal custom choropleth map for Looker Studio (Community Visualization) -->
<!-- This will display your TopoJSON with color scaling -->

<!DOCTYPE html>
<html>
  <head>
    <script src="https://d3js.org/d3.v6.min.js"></script>
    <script src="https://d3js.org/topojson.v2.min.js"></script>
    <style>
      body { margin: 0; }
      svg { width: 100%; height: 100vh; }
    </style>
  </head>
  <body>
    <svg></svg>
    <script>
      console.log("Script is running âœ…");

      const svg = d3.select("svg");
      const color = d3.scaleSequential(d3.interpolateOranges);

google.visualization.events.addListener(window, 'onData', (dsResponse) => {
  const rows = dsResponse.tables.DEFAULT.rows;

  // Expecting: first column = name, second column = value
  const data = {};
  rows.forEach(row => {
    const name = row.c[0].v;
    const value = row.c[1].v;
    data[name] = value;
  });

  drawMap(data);  // call function to draw the map using Looker Studio data
});


      console.log("Starting fetch...");

      fetch("https://yh-mdminae.github.io/mdg-boundary2/geoBoundaries-MDG-ADM2.topojson")
        .then(response => {
          console.log("Fetch successful");
          return response.json();
        })
        .then(topo => {
          console.log("Received topo:", topo);
          console.log("Available TopoJSON object keys:", Object.keys(topo.objects));

          const features = topojson.feature(topo, topo.objects["MDGADM2gbOpen"]).features;
          console.log("Loaded features:", features);
          console.log("Example feature properties:", features[0].properties);

          const projection = d3.geoMercator().fitSize([window.innerWidth, window.innerHeight], {
            type: "FeatureCollection",
            features: features
          });

          const path = d3.geoPath().projection(projection);

          const values = Object.values(data);
          color.domain([Math.min(...values), Math.max(...values)]);

          svg.selectAll("path")
            .data(features)
            .enter().append("path")
            .attr("d", d => {
              const p = path(d);
              console.log("Generated path:", p);
              return p;
            })
            .attr("fill", d => {
              const name = d.properties.shapeName; // Updated to match new dataset field
              console.log("Drawing feature for:", name);
              return data[name] != null ? color(data[name]) : "#ccc";
            })
            .attr("stroke", "#fff");
        })
        .catch(err => {
          console.error("Fetch failed:", err);
        });
    </script>
  </body>
</html>

